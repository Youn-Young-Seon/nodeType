"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const parser_1 = require("./parser");
const fs_1 = require("fs");
const util_1 = require("util");
const write = util_1.promisify(fs_1.writeFile);
function default_1(source, map) {
    const loader = this;
    loader.cacheable && loader.cacheable();
    loader.addDependency(loader.resourcePath);
    const callback = loader.async();
    parser_1.default(source)
        .then(declaration => {
        write(`${loader.resourcePath}.d.ts`, declaration);
        callback && callback(null, source, map);
    })
        .catch(err => {
        loader.emitError(err);
        callback && callback(null, source, map);
    });
}
exports.default = default_1;
;
